#!/bin/bash

# Deploys an app to Heroku

if [ $# -ne 1 ]
then
	echo "USAGE: $0 APP_NAME"
	exit 1
fi

if [ -z "${WORKSPACE}" ]
then
	echo "WORKSPACE must be set"
	exit 1
fi

cd ${WORKSPACE} && \
	git push git@heroku.com:$1.git ${GIT_COMMIT}:master && \
	bundle exec heroku run rake db:migrate --app $1 && \
	bundle exec heroku restart --app $1